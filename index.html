<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>üéâ Welcome to the TEVA Booth!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap 5 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <img src="/assets/images/background.png" alt="bg" class="bg-img" />
    <div class="bg-gradient-overlay"></div>
    <div class="ms-0 ms-md-5 p-4 my-4 my-md-2">
      <header>
        <img src="/assets/images/tevaera.png" class="tevaera-logo" />
      </header>
      <h2 class="text-start my-5 welcome-header">
        WELCOME TO <br />
        <span style="color: rgba(77, 255, 187, 1)">TEVA VIRTUAL BOOTH!</span>
      </h2>
      <div class="header-description mb-5">
        <p>
          Scan. Verify. Collect &nbsp;
          <img src="/assets/images/tevaLogo.png" class="teva-logo" />
          <span style="color: rgba(77, 255, 187, 1)">1000 TEVA</span><br />
          tokens instantly!
        </p>
      </div>

      <form id="rewardForm" novalidate>
        <div class="mb-2 mb-md-5">
          <label for="otp" class="form-label"
            ><h6 style="font-weight: 700">6 Digit OTP</h6>
            <p style="font-size: 0.7rem">
              TEVA booth staff member. They'll give you a 6-digit OTP to verify
              your visit.
            </p>
          </label>
          <input
            type="text"
            class="form-control form-input"
            id="otp"
            placeholder="Enter 6-digit OTP here"
            required
            minlength="6"
            maxlength="6"
            pattern="\d{6}"
          />
          <div class="invalid-feedback">Please enter a valid 6-digit OTP.</div>
        </div>
        <div class="mb-2 mb-md-5">
          <label for="walletAddress" class="form-label">
            <h6 style="font-weight: 700">Wallet Address</h6></label
          >
          <input
            type="text"
            class="form-control form-input"
            id="walletAddress"
            placeholder="Enter wallet address"
            required
            minlength="10"
            autocomplete="off"
          />
          <div class="invalid-feedback">
            Please enter a valid wallet address (minimum 10 characters).
          </div>
        </div>

        <button type="submit" class="btn form-button mt-5 mt-md-3 mt-xl-5" id="submitBtn">
          Submit
          <svg
            width="22"
            height="20"
            viewBox="0 0 22 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.5 1.90002L19 10L10.5 18.1"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path
              d="M2 1.90002L10.5 10L2 18.1"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
          </svg>
        </button>
      </form>
    </div>

    <script>
      const form = document.getElementById("rewardForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!form.checkValidity()) {
          form.classList.add("was-validated");
          return;
        }

        const submitBtn = document.getElementById("submitBtn");
        const originalBtnContent = submitBtn.innerHTML;
        submitBtn.classList.add("verifying");
        submitBtn.disabled = true;
        submitBtn.innerHTML = `<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Verifying...`;

        const walletAddress = document
          .getElementById("walletAddress")
          .value.trim();
        const otp = document.getElementById("otp").value.trim();
        const apiEndpoint = "http://localhost:4100";

        try {
          const response = await fetch(`${apiEndpoint}/event/reward`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ walletAddress, otp }),
          });

          const data = await response.json();

          if (data.message) {
            toastr.success("‚úÖ You‚Äôve earned TEVA rewards üéâ", "Success");
          } else {
            toastr.error(`‚ùå Failed to claim reward: ${data.error}`, "Error");
          }
        } catch (err) {
          toastr.error(`Request failed: ${err.message}`);
        } finally {
          submitBtn.disabled = false;
          submitBtn.classList.remove("verifying");
          submitBtn.innerHTML = originalBtnContent;
        }
      });
    </script>
  </body>
</html>
