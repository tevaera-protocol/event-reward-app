<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>üéâ Welcome to the TEVA Booth!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap 5 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <img src="/assets/images/background.png" alt="bg" class="bg-img" />
    <div class="bg-gradient-overlay"></div>
    <div class="ms-5 my-5">
      <header class="mb-5">
        <img src="/assets/images/tevaera.png" class="tevaera-logo" />
      </header>
      <h2 class="text-start my-5 welcome-header">
        WELCOME TO <br />
        <span style="color: rgba(77, 255, 187, 1)">TEVA VIRTUAL BOOTH!</span>
      </h2>
      <div class="header-description mb-5">
        <p>
          Scan. Verify. Collect &nbsp;
          <img src="/assets/images/tevaLogo.png" class="teva-logo" />
          <span style="color: rgba(77, 255, 187, 1)">1000 TEVA</span><br />
          tokens instantly!
        </p>
      </div>

      <form id="rewardForm" novalidate>
        <div class="mb-3">
          <label for="otp" class="form-label"
            ><h6 style="font-weight: 700">6 Digit OTP</h6>
            <p style="font-size: 0.7rem">
              TEVA booth staff member. They'll give you a 6-digit OTP to verify
              your visit.
            </p>
          </label
          >
          <input
            type="text"
            class="form-control form-input"
            id="otp"
            placeholder="Enter 6-digit OTP here"
            required
            minlength="6"
            maxlength="6"
            pattern="\d{6}"
          />
          <div class="invalid-feedback">Please enter a valid 6-digit OTP.</div>
        </div>
        <div class="mb-3">
          <label for="walletAddress" class="form-label"> <h6 style="font-weight: 700">Wallet Address</h6></label>
          <input
            type="text"
            class="form-control form-input"
            id="walletAddress"
            placeholder="Enter wallet address"
            required
            minlength="10"
          />
          <div class="invalid-feedback">
            Please enter a valid wallet address (minimum 10 characters).
          </div>
        </div>

        <button type="submit" class="btn btn-primary" id="submitBtn">
          Submit
        </button>
      </form>

      <div id="result" class="mt-3"></div>
    </div>

    <script>
      const form = document.getElementById("rewardForm");
      const resultDiv = document.getElementById("result");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!form.checkValidity()) {
          form.classList.add("was-validated");
          return;
        }

        const submitBtn = document.getElementById("submitBtn");
        const originalBtnContent = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = `<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Verifying...`;

        const walletAddress = document
          .getElementById("walletAddress")
          .value.trim();
        const otp = document.getElementById("otp").value.trim();
        const apiEndpoint = "http://localhost:4100";

        try {
          const response = await fetch(`${apiEndpoint}/event/reward`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ walletAddress, otp }),
          });

          const data = await response.json();

          if (data.message) {
            resultDiv.innerHTML = `
        <div class="alert alert-success">
          ‚úÖ You‚Äôve earned TEVA rewards üéâ
        </div>`;
          } else {
            resultDiv.innerHTML = `
        <div class="alert alert-danger">
          ‚ùå Failed to claim reward: ${data.error}.
        </div>`;
          }
        } catch (err) {
          resultDiv.innerHTML = `<div class="alert alert-danger">Request failed: ${err.message}</div>`;
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalBtnContent;
        }
      });
    </script>
  </body>
</html>
